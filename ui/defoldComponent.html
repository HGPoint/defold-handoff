<button id="copyComponentToDefold">Copy Component to Defold</button>
<button id="exportComponentToDefold">Export Component to Defold</button>
<button id="destroyAdvancedDefoldComponent">Destroy Advanced Defold Component</button>

<script>
  const copyComponentToDefold = document.getElementById('copyComponentToDefold');
  const exportComponentToDefold = document.getElementById('exportComponentToDefold');

  function isPluginMessage(event) {
    return event.data?.pluginMessage;
  }

  function downloadComponent(blob, name) {
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = `${name}.gui`;
    link.click();
    URL.revokeObjectURL(url);
  }

  function exportComponent({ components }) {
    const [ component ] = components;
    const blob = new Blob([component.data], { type: 'text/plain' });
    downloadComponent(blob, component.name)
  }

  function putComponentOnClipboard(component) {
    const textarea = document.createElement("textarea");
    textarea.value = component;
    textarea.style.position = "fixed";
    textarea.style.zIndex = -100;
    textarea.style.left = "-10000px";
    textarea.style.top = "-10000px";
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);
  }

  function copyComponent({ components }) {
    const [ component ] = components;
    putComponentOnClipboard(component.data);
  }

  function postMessageToPlugin(type) {
    parent.postMessage({ pluginMessage: { type } }, "*");
  }

  function onCopyComponentToDefold() {
    postMessageToPlugin("copyComponentsToDefold");
  }

  function onComponentsCopiedToDefold(data) {
    copyComponent(data);
  }

  function onExportComponentToDefold() {
    postMessageToPlugin("exportComponentsToDefold");
  }

  function onComponentsExportedToDefold(data) {
    exportComponent(data);
  }

  function onPluginMessage() {
    if (isPluginMessage(event)) {
      const { pluginMessage } = event.data;
      const { type, data } = pluginMessage;
      if (type === "componentsExportedToDefold") {
        onComponentsExportedToDefold(data);
      } else if (type === "componentsCopiedToDefold") {
        onComponentsCopiedToDefold(data);
      }
    }
  }

  function initializeUI() {
    copyComponentToDefold.addEventListener("click", onCopyComponentToDefold);
    exportComponentToDefold.addEventListener("click", onExportComponentToDefold);
    window.addEventListener("message", onPluginMessage);
  }

  initializeUI();
</script>